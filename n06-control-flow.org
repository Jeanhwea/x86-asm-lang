#+TITLE: 控制流
#+AUTHOR: Jinghui Hu
#+EMAIL: hujinghui@buaa.edu.cn
#+DATE: <2024-11-17 Sun>
#+STARTUP: overview num indent
#+OPTIONS: ^:nil


* 比较 compare
#+BEGIN_SRC nasm
  cmp a, b
#+END_SRC

- 计算 a-b 的值
- 对于无符号数字计算，存在以下场景: ZF(Zero Flag), CF(Carry Flag)
  1. a=b => ZF=1, CF=0
  2. a>b => ZF=0, CF=1
  3. a<b => ZF=0, CF=0
- 对于有符号数字计算，存在以下场景: ZF(Zero Flag), OF(Overflow Flag), SF(Sign Flag)
  1. a=b => ZF=1
  2. a>b => ZF=0, OF = SF
  3. a<b => ZF=0, OF <> SF

* 分支 branch
#+BEGIN_SRC nasm
  jmp label
#+END_SRC

| 指令 | 条件                |
|------+---------------------|
| JZ   | branch only if ZF=1 |
| JNZ  | branch only if ZF=0 |
| JO   | branch only if OF=1 |
| JNO  | branch only if OF=0 |
| JS   | branch only if SF=1 |
| JNS  | branch only if SF=0 |
| JC   | branch only if CF=1 |
| JNC  | branch only if CF=0 |
| JP   | branch only if PF=1 |
| JNP  | branch only if PF=0 |

一些跳转的变种新形势
- SHORT 限制在 128 字节
- NEAR 大概限制在 32000 字节
- FAR 基本上只用于实模式切换保护模式
